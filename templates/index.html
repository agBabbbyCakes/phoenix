{% extends 'base.html' %}

{% block content %}
<!-- KPI Row -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="stat bg-base-100 shadow rounded-box">
        <div class="stat-title">Avg Latency</div>
        <div id="kpi-avg-latency" class="stat-value">-</div>
        <div class="stat-desc">Last 60s</div>
    </div>
    <div class="stat bg-base-100 shadow rounded-box">
        <div class="stat-title">Success Rate</div>
        <div id="kpi-success-rate" class="stat-value">-</div>
        <div class="stat-desc">Last 60s</div>
    </div>
    <div class="stat bg-base-100 shadow rounded-box">
        <div class="stat-title">Throughput</div>
        <div id="kpi-throughput" class="stat-value">-</div>
        <div class="stat-desc">Events/min</div>
    </div>
</div>

<!-- Charts -->
<div class="card bg-base-100 shadow mt-4">
    <div class="card-body">
        <h2 class="card-title">Latency</h2>
        <div class="h-64">
            <canvas id="latencyChart"></canvas>
        </div>
    </div>
</div>

<!-- Live Areas via HTMX SSE -->
<div hx-ext="sse" sse-connect="/stream" class="mt-4">
    <div id="metrics-panel" sse-swap="metrics_update" hx-swap="innerHTML">
        <!-- server-rendered metrics partial will be swapped here -->
    </div>
</div>

<!-- Log Table Container -->
<div class="card bg-base-100 shadow mt-4">
    <div class="card-body">
        <h2 class="card-title">Event Log</h2>
        <div class="overflow-x-auto">
            <table class="table table-zebra">
                <thead>
                    <tr>
                        <th>Time (UTC)</th>
                        <th>Bot</th>
                        <th>Latency (ms)</th>
                        <th>Success %</th>
                        <th>Status</th>
                        <th>Tx Hash</th>
                    </tr>
                </thead>
                <tbody id="logTableBody"></tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // expose sample mode flag for JS to toggle badge
  document.body.dataset.sampleMode = "{{ 'true' if sample_mode else 'false' }}";
  if (document.body.dataset.sampleMode === 'true') {
    var el = document.getElementById('sample-mode-ind');
    if (el) el.classList.remove('hidden');
  }
</script>
<script src="/static/js/main.js"></script>
{% endblock %}
