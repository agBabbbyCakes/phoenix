{% extends 'base.html' %}

{% block title %}Phoenix Dashboard ‚Äî Downloads{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-950 text-gray-100">
  <!-- Header -->
  <header class="bg-gray-900/40 backdrop-blur-xl border-b border-gray-800/50">
    <div class="max-w-7xl mx-auto px-6 py-6">
      <h1 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
        ü¶ç Phoenix Dashboard ‚Äî Downloads
      </h1>
      <p class="text-gray-400 mt-2">Standalone applications for Windows, macOS, and Linux</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-6 py-8">
    <!-- Info Section -->
    <div class="bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-200 mb-4">üì¶ Standalone Applications</h2>
      <p class="text-gray-400 mb-4">
        Download the standalone version of Phoenix Dashboard for your platform. These are self-contained executables
        that include everything needed to run the dashboard - no Python installation required!
      </p>
      <div class="bg-cyan-500/10 border border-cyan-500/30 rounded p-4 mt-4">
        <p class="text-sm text-cyan-300">
          <strong>‚ú® Features:</strong> The standalone app opens in its own native window (no browser needed!) and runs the
          dashboard on a local server. Perfect desktop application experience on Windows, Mac, and Linux.
        </p>
      </div>
    </div>

    <!-- Downloads Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Windows -->
      <div class="bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6 hover:border-cyan-500/50 transition-all">
        <div class="mb-4">
          <h3 class="text-lg font-semibold text-gray-200">Windows</h3>
          <p class="text-xs text-gray-500">x64 (64-bit)</p>
        </div>
        <p class="text-sm text-gray-400 mb-4">
          Native desktop application for Windows 10/11. Opens in its own window - no browser needed!
        </p>
        <div class="bg-yellow-500/10 border border-yellow-500/30 rounded p-3 mb-4">
          <p class="text-xs text-yellow-300">
            <strong>‚ö†Ô∏è Windows SmartScreen:</strong> You may see a security warning on first run. 
            Click "More info" ‚Üí "Run anyway" - this is normal for unsigned executables.
          </p>
        </div>
        <div class="space-y-2">
          <a href="/downloads/windows/PhoenixDashboard-Windows-x64.zip" 
             download="PhoenixDashboard-Windows-x64.zip"
             class="block w-full px-4 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded hover:bg-cyan-500/30 transition-all text-center text-sm font-semibold mb-2">
            üì• Download ZIP
          </a>
          <p class="text-xs text-gray-500 text-center mt-2">
            PhoenixDashboard-Windows-x64.zip
          </p>
          <p class="text-xs text-gray-600 text-center mt-1">
            <em>Standalone executable - no installation needed</em>
          </p>
        </div>
      </div>

      <!-- macOS -->
      <div class="bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6 hover:border-cyan-500/50 transition-all">
        <div class="mb-4">
          <h3 class="text-lg font-semibold text-gray-200">macOS</h3>
          <p class="text-xs text-gray-500">Intel & Apple Silicon</p>
        </div>
        <p class="text-sm text-gray-400 mb-4">
          Native macOS desktop application. Opens in its own window - no browser needed!
        </p>
        <div class="space-y-2">
          <a id="macos-download-link"
             href="/downloads/macos/PhoenixDashboard-macOS.zip" 
             download="PhoenixDashboard-macOS.zip"
             class="block w-full px-4 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded hover:bg-cyan-500/30 transition-all text-center text-sm font-semibold mb-2">
            üì• Download ZIP
          </a>
          <p class="text-xs text-gray-500 text-center mt-2">
            PhoenixDashboard-macOS.zip
          </p>
          <p id="macos-status" class="text-xs text-gray-600 text-center mt-1">
            <em>App bundle - drag to Applications</em>
          </p>
          <p id="macos-not-built" class="text-xs text-yellow-400 text-center mt-1 hidden">
            ‚ö†Ô∏è File not built yet. Build on macOS system using build_macos_standalone.sh
          </p>
        </div>
      </div>

      <!-- Linux -->
      <div class="bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6 hover:border-cyan-500/50 transition-all">
        <div class="mb-4">
          <h3 class="text-lg font-semibold text-gray-200">Linux</h3>
          <p class="text-xs text-gray-500">x86_64 (64-bit)</p>
        </div>
        <p class="text-sm text-gray-400 mb-4">
          Native Linux desktop application. Opens in its own window - no browser needed!
        </p>
        <div class="space-y-2">
          <a id="linux-download-link"
             href="/downloads/linux/PhoenixDashboard-Linux-x86_64.zip" 
             download="PhoenixDashboard-Linux-x86_64.zip"
             class="block w-full px-4 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded hover:bg-cyan-500/30 transition-all text-center text-sm font-semibold mb-2">
            üì• Download ZIP
          </a>
          <p class="text-xs text-gray-500 text-center mt-2">
            PhoenixDashboard-Linux-x86_64.zip
          </p>
          <p id="linux-status" class="text-xs text-gray-600 text-center mt-1">
            <em>Standalone executable - make executable and run</em>
          </p>
          <p id="linux-not-built" class="text-xs text-yellow-400 text-center mt-1 hidden">
            ‚ö†Ô∏è File not built yet. Build on Linux system using build_linux_standalone.sh
          </p>
        </div>
      </div>

    </div>

    <!-- Build Instructions -->
    <div class="mt-12 bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-200 mb-4">üî® Building from Source</h2>
      <p class="text-gray-400 mb-4">
        If you want to build the standalone applications yourself, use the provided build scripts:
      </p>
      
      <div class="space-y-4">
        <div class="bg-gray-800/30 rounded p-4">
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">Windows</h3>
          <code class="text-xs text-gray-300 block">build_windows_standalone.bat</code>
        </div>
        
        <div class="bg-gray-800/30 rounded p-4">
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">macOS</h3>
          <code class="text-xs text-gray-300 block">chmod +x build_macos_standalone.sh<br>./build_macos_standalone.sh</code>
        </div>
        
        <div class="bg-gray-800/30 rounded p-4">
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">Linux</h3>
          <code class="text-xs text-gray-300 block">chmod +x build_linux_standalone.sh<br>./build_linux_standalone.sh</code>
        </div>
        
      </div>
    </div>

    <!-- Usage Instructions -->
    <div class="mt-8 bg-gray-900/20 border border-gray-800/50 backdrop-blur-sm rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-200 mb-4">üìñ Usage Instructions</h2>
      <div class="space-y-4 text-gray-400">
        <div>
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">Windows</h3>
          <ol class="list-decimal list-inside space-y-1 text-sm">
            <li>Download <code class="bg-gray-800/50 px-1 rounded">PhoenixDashboard-Windows-x64.exe</code></li>
            <li>Double-click the executable to launch</li>
            <li><strong>If Windows SmartScreen appears:</strong> Click "More info" ‚Üí "Run anyway"</li>
            <li>A native window will open with the dashboard (no browser needed!)</li>
            <li>Close the window to exit the application</li>
          </ol>
        </div>
        
        <div>
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">macOS</h3>
          <ol class="list-decimal list-inside space-y-1 text-sm">
            <li>Download and extract <code class="bg-gray-800/50 px-1 rounded">PhoenixDashboard-macOS.zip</code></li>
            <li>Move <code class="bg-gray-800/50 px-1 rounded">PhoenixDashboard.app</code> to your Applications folder</li>
            <li>Double-click to launch (you may need to allow it in Security settings)</li>
            <li>A native window will open with the dashboard (no browser needed!)</li>
          </ol>
        </div>
        
        <div>
          <h3 class="text-sm font-semibold text-cyan-400 mb-2">Linux</h3>
          <ol class="list-decimal list-inside space-y-1 text-sm">
            <li>Download and extract <code class="bg-gray-800/50 px-1 rounded">PhoenixDashboard-Linux-x86_64.zip</code></li>
            <li>Make it executable: <code class="bg-gray-800/50 px-1 rounded">chmod +x PhoenixDashboard-Linux-x86_64/PhoenixDashboard</code></li>
            <li>Run: <code class="bg-gray-800/50 px-1 rounded">./PhoenixDashboard-Linux-x86_64/PhoenixDashboard</code></li>
            <li>A native window will open with the dashboard (no browser needed!)</li>
          </ol>
        </div>
      </div>
    </div>
  </main>
</div>


<script>
// Check if file exists and update UI accordingly
async function checkFileExists(url, linkId, statusId, notBuiltId, platform) {
  try {
    const response = await fetch(url, { method: 'HEAD' });
    const link = document.getElementById(linkId);
    const status = document.getElementById(statusId);
    const notBuilt = document.getElementById(notBuiltId);
    
    if (!response.ok || response.status === 404) {
      // File doesn't exist
      if (link) {
        link.classList.add('opacity-50', 'cursor-not-allowed');
        link.onclick = function(e) {
          e.preventDefault();
          alert(`${platform} build not available yet.\n\nTo build:\n- Linux: Run build_linux_standalone.sh on a Linux system\n- macOS: Run build_macos_standalone.sh on a macOS system`);
          return false;
        };
      }
      if (status) status.classList.add('hidden');
      if (notBuilt) notBuilt.classList.remove('hidden');
      return false;
    } else {
      // File exists
      if (link) {
        link.classList.remove('opacity-50', 'cursor-not-allowed');
        link.onclick = null;
      }
      if (status) status.classList.remove('hidden');
      if (notBuilt) notBuilt.classList.add('hidden');
      return true;
    }
  } catch (error) {
    // Network error or file doesn't exist
    const link = document.getElementById(linkId);
    const status = document.getElementById(statusId);
    const notBuilt = document.getElementById(notBuiltId);
    
    if (link) {
      link.classList.add('opacity-50', 'cursor-not-allowed');
      link.onclick = function(e) {
        e.preventDefault();
        alert(`${platform} build not available yet.\n\nTo build:\n- Linux: Run build_linux_standalone.sh on a Linux system\n- macOS: Run build_macos_standalone.sh on a macOS system`);
        return false;
      };
    }
    if (status) status.classList.add('hidden');
    if (notBuilt) notBuilt.classList.remove('hidden');
    return false;
  }
}

// Check file availability on page load
document.addEventListener('DOMContentLoaded', async function() {
  // Check Linux ZIP
  await checkFileExists(
    '/downloads/linux/PhoenixDashboard-Linux-x86_64.zip',
    'linux-download-link',
    'linux-status',
    'linux-not-built',
    'Linux'
  );
  
  // Check macOS ZIP (try both possible architectures)
  const macosUrls = [
    '/downloads/macos/PhoenixDashboard-macOS-arm64.zip',
    '/downloads/macos/PhoenixDashboard-macOS-x86_64.zip',
    '/downloads/macos/PhoenixDashboard-macOS.zip'
  ];
  
  let macosFound = false;
  for (const url of macosUrls) {
    try {
      const response = await fetch(url, { method: 'HEAD' });
      if (response.ok) {
        // Update link to point to the actual file
        const link = document.getElementById('macos-download-link');
        if (link) {
          link.href = url;
          link.download = url.split('/').pop();
        }
        macosFound = true;
        break;
      }
    } catch (e) {
      continue;
    }
  }
  
  if (!macosFound) {
    await checkFileExists(
      '/downloads/macos/PhoenixDashboard-macOS.zip',
      'macos-download-link',
      'macos-status',
      'macos-not-built',
      'macOS'
    );
  } else {
    // File exists, show normal status
    const status = document.getElementById('macos-status');
    const notBuilt = document.getElementById('macos-not-built');
    if (status) status.classList.remove('hidden');
    if (notBuilt) notBuilt.classList.add('hidden');
  }
});
</script>
{% endblock %}

